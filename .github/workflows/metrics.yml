name: ðŸ“Š Code Quality Analysis

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  metrics:
    name: ðŸ“ˆ Code Metrics
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ðŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: ðŸ“Š Analyze Frontend
        working-directory: ./client
        run: |
          npm ci
          echo "### Frontend Analysis" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Build Size Analysis:**" >> $GITHUB_STEP_SUMMARY
          npm run build 2>&1 | grep -i "bundle\|chunk\|size" >> $GITHUB_STEP_SUMMARY || true
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "âœ… Build completed successfully" >> $GITHUB_STEP_SUMMARY

      - name: ðŸ“Š Analyze Backend
        working-directory: ./server
        run: |
          npm ci
          echo "### Backend Analysis" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**TypeScript Compilation:**" >> $GITHUB_STEP_SUMMARY
          npm run build 2>&1 | tail -5 >> $GITHUB_STEP_SUMMARY || true
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "âœ… Build completed successfully" >> $GITHUB_STEP_SUMMARY

  file-count:
    name: ðŸ“ Repository Statistics
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ðŸ“Š Generate Statistics
        run: |
          echo "### Repository Statistics" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**File Count:**" >> $GITHUB_STEP_SUMMARY
          echo "- TypeScript files: $(find . -name '*.ts' -o -name '*.tsx' | wc -l)" >> $GITHUB_STEP_SUMMARY
          echo "- JSON files: $(find . -name '*.json' | wc -l)" >> $GITHUB_STEP_SUMMARY
          echo "- CSS files: $(find . -name '*.css' | wc -l)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Directory Structure:**" >> $GITHUB_STEP_SUMMARY
          echo "- Client: $(ls -la client/ | wc -l) items" >> $GITHUB_STEP_SUMMARY
          echo "- Server: $(ls -la server/ | wc -l) items" >> $GITHUB_STEP_SUMMARY
          echo "- Documentation: $(ls -la *.md 2>/dev/null | wc -l) files" >> $GITHUB_STEP_SUMMARY
